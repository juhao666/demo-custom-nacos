<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>配置编辑器</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <h1>配置编辑器</h1>
    <form id="configForm">
        <div class="form-group">
            <label for="dataId">Data ID</label>
            <input type="text" id="dataId" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="group">Group</label>
            <input type="text" id="group" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="content">配置内容</label>
            <textarea id="content" class="form-control" rows="5" required></textarea>
        </div>
        <button type="button" class="btn btn-primary" onclick="loadConfig()">加载配置</button>
        <button type="button" class="btn btn-success" onclick="saveConfig()">保存配置</button>
    </form>
</div>

<script>
    function loadConfig() {
        const dataId = $('#dataId').val();
        const group = $('#group').val();
        if (!dataId || !group) {
            alert('请填写 Data ID 和 Group');
            return;
        }

        $.get(`/api/v1/config?dataId=${dataId}&group=${group}`, function(data) {
            if (data.success) {
                $('#content').val(data.data.content); // 使用 content 属性
            } else {
                alert(data.message);
            }
        }).fail(function() {
            alert('加载配置失败');
        });
    }

    function saveConfig() {
        const dataId = $('#dataId').val();
        const group = $('#group').val();
        const content = $('#content').val();

        const configItem = {
            dataId: dataId,
            group: group,
            content: content, // 使用 content 属性
            // 其他字段可根据需要添加
            type: "properties", // 假设类型为 properties，可以根据实际情况修改
            version: 1, // 版本号可以根据实际情况设置
            md5: "", // MD5 可以在后端处理
            updateTime: Date.now() // 更新时间为当前时间戳
        };

        $.ajax({
            url: '/api/v1/config',
            type: 'POST',
            contentType: 'application/json', // 设置请求内容类型
            data: JSON.stringify(configItem), // 将对象转换为 JSON 字符串
            success: function(data) {
                if (data.success) {
                    alert('配置已保存！');
                } else {
                    alert(data.message);
                }
            },
            error: function() {
                alert('保存配置失败');
            }
        });
    }
</script>
</body>
</html>
